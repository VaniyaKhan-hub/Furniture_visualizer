<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
        integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body>

    <!-- header -->
    <%- include('header.ejs'); %>

        <div id="setdisplay">

            <div class="prod-detail">
                <div class="prod-image">
                    <img id="main-image" src="/assets/<%= data.Image1 %>" alt="sofa">
                    <div class="prod-thumbnails">
                        <img src="/assets/<%= data.Image1 %>" alt="Sofa" data-src="/assets/<%= data.Image1 %>">
                        <img src="/assets/<%= data.Image2 %>" alt="" data-src="/assets/<%= data.Image2 %>">
                        <img src="/assets/<%= data.Image3 %>" alt="" data-src="/assets/<%= data.Image3 %>">
                    </div>

                </div>

                <div class="prod-info">
                    <h2>
                        <%= data.Title%>
                    </h2>
                    <div class="rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>

                    </div>
                    <p class="price">
                        <%= data.Price%>
                    </p>
                    <div class="product-options">
                        <label for="quantity">Quantity:</label>
                        <input type="number" id="quantity" name="quantity" min="1" value="1">
                    </div>
                    <div class="view fbtn">
                        <button class="add-to-cart-btn" data-product="<%= data._id %>">Add To Cart</button>
                        <p class="wishlist-toggle" data-product="<%= data._id %>">
                            <a href="/wishlist/add/<%= data._id %>">
                                <i class="fa-regular fa-heart" style="color: #e60000; cursor: pointer;"
                                    title="Add to Wishlist"></i>
                            </a>
                        </p>

                    </div>
                </div>

                <div class="prod-description">
                    <h3>Product Description</h3>
                    <p class="description">
                        <%= data.Description %>
                    </p>
                </div>

                <div class="prod-description">
                    <h3>Product Specification</h3>
                    <p class="description">
                        <%= data.Specifications %>
                    </p>
                </div>

                <div class="prod-description">
                    <h3>Product Material</h3>
                    <p class="description">
                        <%= data.Material %>
                    </p>
                </div>

                <div class="prod-description">
                    <h3>Dimensions</h3>
                    <table class="description">
                        <tr>
                            <td>Overall Dimensions:</td>
                            <td>
                                <%= data.Dimensions %>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <button id="myBtn" class="pro">Visualize In My Room</button>

            <!-- The Modal -->
            <div id="myModal" class="modal">

                <!-- Modal content -->
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2>Enter Room Details</h2>
                    <form id="roomForm" enctype="multipart/form-data">
                        <input type="hidden" name="sofaImage" value="/assets/<%= data.Image1 %>">

                        <label>Number of Walls</label>
                        <select name="numWalls">
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="other">Other</option>
                        </select>

                        <label>Wall Color</label>
                        <input type="text" name="wallColor" placeholder="e.g., White, Light Gray" />
                        <label for="roomType">Room Type</label>
                        <select id="roomType" name="roomType" required>
                            <option value="">Select Room Type</option>
                            <option value="bedroom">Bedroom</option>
                            <option value="livingroom">Living Room</option>
                            <option value="diningroom">Dining Room</option>
                            <option value="office">Office</option>
                            <option value="other">Other</option>
                        </select>

                        <label for="dimensions">Room Dimensions (in meters)</label>
                        <input type="text" id="dimensions" name="dimensions" placeholder="e.g., 4 x 3 x 2.5" required>

                        <label for="placement">Preferred Furniture Placement (optional)</label>
                        <textarea id="placement" name="placement"
                            placeholder="e.g., Near the window, against the left wall"></textarea>

                        <label for="roomImage">Upload Room Image</label>
                        <input type="file" id="roomImage" name="roomImage" accept="image/*" required>

                        <button type="submit" class="pro">Submit & Visualize</button>
                    </form>
                </div>

            </div>
        </div>
        <%- include('footer.ejs'); %>
</body>

<!-- Wishlist Link -->
<script src="/js/wishlist.js"></script>

<!-- Add to Cart Link -->
<script src="/js/addtocart.js"></script>

<!-- CartCount Link -->
<script src="/js/cartcount.js"></script>
<script src="/js/main.js"></script>

<script>
    // Get the modal
    var modal = document.getElementById("myModal");

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal 
    btn.onclick = function () {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    // <script>
document.getElementById("roomForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const formData = new FormData(this);

  Swal.fire({
    title: "Visualizing...",
    text: "Placing sofa in your room",
    allowOutsideClick: false,
    didOpen: () => Swal.showLoading()
  });

  try {
    const res = await fetch("/ai/visualize", {
      method: "POST",
      body: formData
    });

    const data = await res.json();

 Swal.fire({
  title: "Visualization Ready",
  html: `<img src="${data.resultImage}" style="width:100%;border-radius:10px;">`,
  confirmButtonText: "Close"
});


  } catch (err) {
    Swal.fire("Error", "Something went wrong", "error");
  }
});
// </script>

</script>

</html>